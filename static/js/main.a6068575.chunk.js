(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{146:function(e,a,t){e.exports=t.p+"static/media/logo.b0ae2d50.svg"},174:function(e,a,t){e.exports=t(333)},179:function(e,a,t){},184:function(e,a,t){},186:function(e,a,t){},188:function(e,a,t){},314:function(e,a,t){},316:function(e,a,t){},333:function(e,a,t){"use strict";t.r(a);var n=t(0),s=t.n(n),i=t(47),o=t.n(i),l=(t(179),t(181),t(28)),r=t(29),c=t(31),d=t(30),m=t(32),u=t(146),p=t.n(u),g=t(48),h=t.n(g),v=(t(184),t(346)),f=t(332),E=t(341),b=t(347),S=t(343),y=(t(186),t(73)),C=t(344),w=t(140),N=t(345),A=(t(188),function(e){function a(){var e,t;Object(l.a)(this,a);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(t=Object(c.a)(this,(e=Object(d.a)(a)).call.apply(e,[this].concat(s)))).state={emailUp:"",passwordUp:"",confirmPasswordUp:"",displayName:""},t.handleChange=function(e){return t.setState(Object(y.a)({},e.target.id,e.target.value))},t.handleSubmit=function(){var e=t.state,a=e.emailUp,n=e.passwordUp,s=e.confirmPasswordUp,i=e.displayName;console.log(a),n===s&&t.props.onSignUp(a,n,i)},t}return Object(m.a)(a,e),Object(r.a)(a,[{key:"render",value:function(){return s.a.createElement("div",{id:"signup"},s.a.createElement(E.a,{padded:"very"},s.a.createElement("div",{className:"borders"},s.a.createElement(v.a,{as:"h1"},"Signup"),s.a.createElement(C.a,{onSubmit:this.handleSubmit},s.a.createElement(C.a.Field,null,s.a.createElement("label",null,s.a.createElement(w.a,{name:"user"})," Display Name"),s.a.createElement("input",{className:"field",placeholder:"John",id:"displayName",onChange:this.handleChange})),s.a.createElement(C.a.Field,null,s.a.createElement("label",null,s.a.createElement(w.a,{name:"mail"})," Email"),s.a.createElement("input",{className:"field",type:"email",id:"emailUp",placeholder:"john123@email.com",onChange:this.handleChange})),s.a.createElement(C.a.Field,null,s.a.createElement("label",null,s.a.createElement(w.a,{name:"key"})," Password"),s.a.createElement("input",{className:"field",type:"password",id:"passwordUp",placeholder:"Password",onChange:this.handleChange})),s.a.createElement(C.a.Field,null,s.a.createElement("label",null,s.a.createElement(w.a,{name:"key"})," Confirm Password"),s.a.createElement("input",{className:"field",type:"password",id:"confirmPasswordUp",placeholder:"Password",onChange:this.handleChange})),s.a.createElement("div",{style:{textAlign:"center"}},s.a.createElement(N.a,{secondary:!0},"Signup"))))))}}]),a}(s.a.Component)),k=(t(314),function(e){function a(){var e,t;Object(l.a)(this,a);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(t=Object(c.a)(this,(e=Object(d.a)(a)).call.apply(e,[this].concat(s)))).state={email:"",password:""},t.handleChange=function(e){return t.setState(Object(y.a)({},e.target.id,e.target.value))},t.handleSubmit=function(){var e=t.state,a=e.email,n=e.password;a&&n&&t.props.onSignIn(a,n)},t}return Object(m.a)(a,e),Object(r.a)(a,[{key:"render",value:function(){return s.a.createElement("div",{id:"login"},s.a.createElement(E.a,{padded:"very"},s.a.createElement("div",{className:"borders"},s.a.createElement(v.a,{as:"h1"},"Login"),s.a.createElement(C.a,{onSubmit:this.handleSubmit},s.a.createElement(C.a.Field,null,s.a.createElement("label",null,s.a.createElement(w.a,{name:"mail"})," Email"),s.a.createElement("input",{className:"field",placeholder:"john123@email.com",id:"email",value:this.state.email,onChange:this.handleChange})),s.a.createElement(C.a.Field,null,s.a.createElement("label",null,s.a.createElement(w.a,{name:"key"})," Password"),s.a.createElement("input",{className:"field",type:"password",placeholder:"Password",id:"password",value:this.state.password,onChange:this.handleChange})),s.a.createElement("div",{style:{textAlign:"center"}},s.a.createElement(N.a,{secondary:!0},"Login"))))))}}]),a}(s.a.Component)),U=function(e){return s.a.createElement("div",null,s.a.createElement(v.a,{color:"teal",as:"h1",textAlign:"center"},s.a.createElement(f.a,{src:h.a}),"Node Messenger"),s.a.createElement(E.a,{inverted:!0,color:"black",compact:!0,padded:"very"},s.a.createElement(b.a,{columns:2},s.a.createElement(b.a.Column,null,s.a.createElement(k,{onSignIn:e.onSignIn})),s.a.createElement(S.a,{inverted:!0,color:"white",vertical:!0,style:{left:"50%"}},"Or"),s.a.createElement(b.a.Column,null,s.a.createElement(A,{onSignUp:e.onSignUp})))))},O=function(e){return s.a.createElement("header",{className:"App-header"},s.a.createElement(b.a,{style:{height:"100%"},verticalAlign:"middle"},s.a.createElement(b.a.Column,null,s.a.createElement("div",{id:"box"},s.a.createElement(U,{onSignIn:e.onSignIn,onSignUp:e.onSignUp})))))},j=t(55),R=t(139),L=t(342),D=t(262),M=(t(316),function(e){return s.a.createElement("div",null,s.a.createElement("div",{id:"name",className:e.alignment},e.showDisplayName?e.sentBy:""),s.a.createElement("div",null,s.a.createElement("div",{className:[e.alignment,"message"].join(" ")},s.a.createElement("div",{id:"message-data",className:"r"===e.alignment?"userColor":"otherColor"},e.message),s.a.createElement("div",{id:"timeShow",className:"r"===e.alignment?"timeL":"r"},e.timeSent.toLocaleString()))))}),I=function(e){return s.a.createElement("div",{className:"conversation-card",id:e.selected?"conversation-card-selected":"",onClick:function(){return e.handleClick(e.cid)}},s.a.createElement("div",{id:"conversation-icon"},s.a.createElement(w.a,{size:"big",name:e.icon})),s.a.createElement("div",{id:"conversation-info"},s.a.createElement(v.a,null,e.members)))},P=function(e){function a(e){var t;return Object(l.a)(this,a),(t=Object(c.a)(this,Object(d.a)(a).call(this,e))).componentDidUpdate=function(e,a){var n=document.getElementById("message-area");if(n.scrollTop=n.scrollHeight,t.state.conversationRef){if(a.conversationRef!==t.state.conversationRef){a.messageUnsubscribe&&(console.log("detaching"),a.messageUnsubscribe());var s=t.state.databaseRef.collection("messages").doc(t.state.conversationRef).collection("messageData").orderBy("timeSent").startAt(t.state.fetchTimestamp).onSnapshot(function(e){console.log(e.docs),e.docChanges().forEach(function(e){if("added"===e.type){var a=e.doc;"Server"===(a.metadata.hasPendingWrites?"Local":"Server")&&t.setState({messages:Object(j.a)(t.state.messages).concat([{message:a.data().message,timeSent:a.data().timeSent.toDate(),uid:a.data().uid,displayName:a.data().displayName}])})}})});t.setState({messageUnsubscribe:s})}}else console.log("returning")},t.componentWillUnmount=function(){t.state.messageUnsubscribe&&t.state.messageUnsubscribe()},t.showMessages=function(e){if(t.state.conversationRef||e!==t.state.conversationRef){console.log("showing messsages");var a=t.state.databaseRef.collection("messages").doc(e).collection("messageData");if(a){var n=[];a.orderBy("timeSent","desc").limit(t.state.initLoadMessages).get().then(function(a){if(0!==a.docs.length){for(var s=a.docs.length-1;s>=0;s--){var i=a.docs[s];n.push({message:i.data().message,timeSent:i.data().timeSent.toDate(),uid:i.data().uid,displayName:i.data().displayName})}t.setState({conversationRef:e,messages:n,fetchTimestamp:new Date,lastLoadedDocTimestamp:n[0].timeSent,partialLoad:!0})}else t.setState({conversationRef:e})}).catch(function(e){return console.log(e)})}}},t.loadMoreMessages=function(e){var a=t.state.messages.slice();t.state.databaseRef.collection("messages").doc(t.state.conversationRef).collection("messageData").orderBy("timeSent","desc").startAt(t.state.lastLoadedDocTimestamp).limit(t.state.nextLoad+1).get().then(function(e){console.log(e.docs),1===e.docs.length&&t.setState({partialLoad:!1});for(var n=1;n<e.docs.length;n++){var s=e.docs[n];console.log(s.data()),a.unshift({message:s.data().message,timeSent:s.data().timeSent.toDate(),uid:s.data().uid,displayName:s.data().displayName})}t.setState({messages:a,lastLoadedDocTimestamp:a[0].timeSent})})},t.sendMessage=function(e){if(t.state.conversationRef){var a=t.state.conversationRef,n=t.state.databaseRef;e.preventDefault();var s=document.getElementById("message-input");if(""!==s.value){var i=new Date,o={message:s.value,uid:t.state.user.uid,timeSent:i};s.value="",t.setState({messages:Object(j.a)(t.state.messages).concat([o])}),n.collection("messages").doc(a).collection("messageData").add({message:o.message,timeSent:i,uid:t.state.user.uid,displayName:t.state.user.displayName})}}},t.showAddConvPopUp=function(){t.setState({addConv:!t.state.addConv,membersToAdd:[]})},t.handleAddEmail=function(e){t.state.databaseRef;var a=document.getElementById("popup-emailInput"),n=a.value;if(n&&(a.value="",!t.state.membersToAdd.find(function(e){return e.email===n})&&n!==t.state.user.email)){t.state.databaseRef.collection("users").where("email","==",n).get().then(function(e){var a=e.docs[0];a&&t.setState({membersToAdd:Object(j.a)(t.state.membersToAdd).concat([{displayName:a.data().displayName,email:n,uid:a.id}])})})}},t.handleAddConversation=function(e){if(0!==t.state.membersToAdd.length){var a=Object(j.a)(t.state.membersToAdd).concat([{displayName:t.state.user.displayName,uid:t.state.user.uid,email:t.state.user.email}]),n=t.state.databaseRef;n.collection("conversations").add({members:a,lastActive:new Date,lastMessage:""}).then(function(e){a.forEach(function(a){n.collection("users").doc(a.uid).update({conversations:t.props.firebaseRef.firestore.FieldValue.arrayUnion(e)})}),t.state.messageUnsubscribe&&t.state.messageUnsubscribe(),t.setState({addConv:!t.state.addConv,messages:[]}),t.showMessages(e.id)}).catch(function(e){console.error("Error writing document: ",e)})}},console.log(t.props.user),t.state={conversations:[],addConv:!1,addSuccess:!1,user:t.props.user,messages:[],messageUnsubscribe:null,conversationRef:null,databaseRef:t.props.database,fetchTimestamp:null,membersToAdd:[],initLoadMessages:50,partialLoad:!1,lastLoadedDocTimestamp:null,nextLoad:100},t}return Object(m.a)(a,e),Object(r.a)(a,[{key:"componentDidMount",value:function(){var e=this,a=[],t=this.state.databaseRef;t.collection("users").doc(this.state.user.uid).onSnapshot(function(n){var s=[];n.data().conversations.forEach(function(e){s.push(t.collection("conversations").doc(e.id).get())}),console.log(s),Promise.all(s).then(function(t){a=[],t.forEach(function(e){return a.push({cid:e.id,members:e.data().members,lastMessage:e.data().lastMessage.message,lastActive:e.data().lastActive.toDate()})}),a.sort(function(e,a){return e.lastActive>a.lastActive?1:a.lastActive>e.lastActive?-1:0}),console.log(a),e.setState({conversations:a})})})}},{key:"render",value:function(){for(var e=this,a=(s.a.createElement(R.a,null," "),this.state.membersToAdd.map(function(e){return s.a.createElement(E.a,{key:e.uid}," ",e.email," (",e.displayName,")")})),t=this.state.addConv?s.a.createElement("div",{id:"popup-container"},s.a.createElement("div",{id:"popup-addConversation"},s.a.createElement("div",{id:"popup-title"},s.a.createElement(v.a,{size:"large",inverted:!0},"Enter user email"),s.a.createElement(w.a,{inverted:!0,size:"big",id:"popup-icon",name:"close",onClick:this.showAddConvPopUp})),s.a.createElement(S.a,null),s.a.createElement(C.a,{onSubmit:this.handleAddEmail},s.a.createElement(L.a,{id:"popup-emailInput",style:{width:"100%"},icon:s.a.createElement(w.a,{name:"add user",circular:!0,link:!0,onClick:this.handleAddEmail}),placeholder:"Add by Email..."})),s.a.createElement(D.a,{id:"popup-members"},a),s.a.createElement(S.a,null),s.a.createElement(E.a,{id:"popup-start",onClick:this.handleAddConversation},"Start Conversation"))):null,n=this.state.user.uid,i=[],o=0;o<this.state.messages.length;o++){var l=this.state.messages[o],r=n===l.uid?"r":"l",c=(0===o||this.state.messages[o-1].uid!==l.uid)&&"r"!==r;console.log(c,l),i.push(s.a.createElement(M,{key:o,alignment:r,sentBy:l.displayName,timeSent:l.timeSent,showDisplayName:c,message:l.message}))}this.state.partialLoad&&(i=s.a.createElement("div",null,s.a.createElement(N.a,{onClick:this.loadMoreMessages},"Load More Messages"),i));var d=this.state.conversations.map(function(a){var t=a.members.map(function(e){if(e.uid!==n)return s.a.createElement("div",{key:e.displayName},e.displayName)}),i="user";return a.members.length>2&&(i="users"),s.a.createElement(I,{key:a.cid,selected:e.state.conversationRef===a.cid,icon:i,members:t,lastMessage:a.lastMessage,cid:a.cid,handleClick:e.showMessages})});return s.a.createElement("div",{id:"chat-grid"},t,s.a.createElement("div",{id:"chat-conversation-sidebar"},s.a.createElement("div",{id:"conversation-title-container"},s.a.createElement(v.a,{color:"teal",as:"h4",textAlign:"center"},s.a.createElement(f.a,{src:h.a}),"Node Messenger"),s.a.createElement(S.a,null)),s.a.createElement("div",{id:"conversation-conversationList"},d),s.a.createElement("div",{id:"conversation-usercontrols"},s.a.createElement(S.a,{id:"conversation-divider"}),s.a.createElement("div",{id:"conversation-signout",onClick:this.props.onSignOut},"Sign Out"),s.a.createElement("div",{id:"conversation-addConv",onClick:this.showAddConvPopUp},s.a.createElement(w.a,{inverted:!0,size:"big",name:"add user"})))),s.a.createElement("div",{id:"chat-divider"}),s.a.createElement("div",{id:"chat-message-box"},s.a.createElement("div",{id:"message-area"},i),s.a.createElement("div",null,s.a.createElement(C.a,{id:"message-box",autoComplete:"off",onSubmit:this.sendMessage},s.a.createElement(L.a,{id:"message-input",fluid:!0,icon:s.a.createElement(w.a,{name:"send",color:"blue",onClick:this.sendMessage,circular:!0,link:!0}),placeholder:"Type a message"})))))}}]),a}(s.a.Component),T=function(){return s.a.createElement("header",{className:"App-header"},s.a.createElement("div",null,s.a.createElement("div",null,s.a.createElement("img",{alt:"Logo",src:h.a,className:"AppLogo"})),s.a.createElement("div",null,s.a.createElement("img",{src:p.a,className:"Loading-logo",alt:"Loading"}))))},x=function(e){function a(e){var t;return Object(l.a)(this,a),(t=Object(c.a)(this,Object(d.a)(a).call(this,e))).handleSignIn=function(e,a){t.props.firebase.auth().signInWithEmailAndPassword(e,a).then(function(n){console.log(n),t.signIn(e,a)}).catch(function(e){console.log(e)})},t.handleSignUp=function(e,a,n){t.props.firebase.auth().createUserWithEmailAndPassword(e,a).then(function(a){a.user.updateProfile({displayName:n}).then().catch(function(e){return console.log(e)}),t.state.databaseRef.collection("users").doc(a.user.uid).set({displayName:n,email:e,conversations:[]}).then().catch(function(e){return console.log(e)})}).catch(function(e){console.log(e)})},t.handleSignOut=function(){console.log("signing out"),t.props.firebase.auth().signOut().then(function(){}).catch(function(e){})},t.state={authChecked:!1,user:null,databaseRef:t.props.firebase.firestore()},t.state.databaseRef.settings({timestampsInSnapshots:!0}),t}return Object(m.a)(a,e),Object(r.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.props.firebase.auth().onAuthStateChanged(function(a){console.log("authchecked"),e.setState({user:a,authChecked:!0})})}},{key:"render",value:function(){var e,a=this.state.user;return e=this.state.authChecked?a?s.a.createElement(P,{firebaseRef:this.props.firebase,database:this.state.databaseRef,onSignOut:this.handleSignOut,user:a}):s.a.createElement(O,{onSignIn:this.handleSignIn,onSignUp:this.handleSignUp}):s.a.createElement(T,null),s.a.createElement("div",{className:"App"},e)}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var B=t(145);B.initializeApp({apiKey:"AIzaSyDiUZegEvS10yKuSLMS0V2ZurdbJXyIYP4",authDomain:"nodem-2edaa.firebaseapp.com",databaseURL:"https://nodem-2edaa.firebaseio.com",projectId:"nodem-2edaa",storageBucket:"nodem-2edaa.appspot.com",messagingSenderId:"33137095871"}),o.a.render(s.a.createElement(x,{firebase:B}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},48:function(e,a,t){e.exports=t.p+"static/media/applogo.f8c49c79.svg"}},[[174,2,1]]]);
//# sourceMappingURL=main.a6068575.chunk.js.map